<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="ml4u-item-comments">

<style is="custom-style">
.comment {
  display: block;
  background: #FFFFFF;
  padding: 15px 25px 15px 25px;
  box-shadow: 0 1px 3px 0 rgba(0,0,0,0.35);
  color: rgb(120,120,120);
}
.username {
  color: rgb(74,74,74);
  font-weight: 500;
  margin-right: 4px;
}
.add-comment {
  width: 100%;
  background: #FAFAFA;
  box-shadow: 0 1px 2px 0 rgba(0,0,0,0.45);
  border: none;
  padding: 15px 20px 15px 20px;
  margin-bottom: 10px;
  border-top: 1px solid rgb(208,208,208);
  font-family: 'effra', sans-serif;
  color: rgb(122,122,122);
  font-weight: 500;
  font-size: 1.3em;
  cursor: pointer;
}
.add-comment:hover {
  background: #EFEFEF;
}
.no-comments {
  background: white;
  padding-top: 25px;
  padding-bottom: 25px;
  text-align: center;
  font-family: 'effra', sans-serif;
  font-size: 1.2em;
  color: rgb(72,72,72);
  line-height: 1.4;
  box-shadow: 0 1px 3px 0 rgba(0,0,0,0.35);
}
</style>
<template>
  <div class="wrapper">
  <template is="dom-if" if="{{!commentsArray.length}}">
    <div class="no-comments">No comments yet!<br/>Why not start the ball rolling?</div>
  </template>
  <template is="dom-repeat" items="[[commentsArray]]">
    <div class="comment">
    <span class="username">[[item.username]]</span>
    [[item.comment]]
    <div>
  </template>

  <!--
  <b>New Comment:</b>
  <textarea rows="3" cols="50" id="newCommentInput">
  </textarea>

  -->
  <button class="add-comment" type="button" on-tap="_submitNewComment">+ Add Comment</button>
  </div>
</template>

  <script>
  Polymer({
    is: 'ml4u-item-comments',
    properties: {
      profileData: {
        type: Object,
        notify: true
      },
      commentsArray: {
        type: Array,
        observer: '_onCommentsArrayChanged'
      }
    },
    _onCommentsArrayChanged: function(newValue) {
       console.log("!!!!!!!!!!!!!!!!_onCommentsArrayChanged called");
       console.log(newValue);
    },
    _submitNewComment: function(newValue) {
      newComment = new Object();
      newComment.id = 3;
      newComment.username = "MyCurrentUsername";
      newComment.comment = this.$.newCommentInput.value;

      var xhr = new XMLHttpRequest();
      // xhr.addEventListener('load', rq.onLoad.bind(this));
      xhr.addEventListener('load', function(e){
        this.$.newCommentInput.value = "";
        this.push('commentsArray', newComment);
      }.bind(this));
      xhr.addEventListener('error', function(e) {
        console.log("!!!!!!!!!!!!!!!!!error received!");
        // for now, no need to do anything
      }.bind(this));
      xhr.open("POST", "https://leggetter-cors.herokuapp.com/", true);
      //xhr.open("POST", "http://localhost:8000/icml/registration/", true);
      xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      // xhr.send(rq.uriEncodedPostData);
      xhr.send();
      // this.commentsArray.push(newComment);
    }
  });
  </script>
</dom-module>
