<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-signals/iron-signals.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="ml4u-nav.html">
<link rel="import" href="ml4u-list.html">

<dom-module id="ml4u-page-schedule">
  <template>
    <style include="shared-styles">
      paper-icon-button.favourite {
        color: GoldenRod;
        --paper-icon-button-ink-color: var(GoldenRod);
      }
    </style>
    <iron-signals on-iron-signal-schedule="_onScheduleDataChanged"><iron-signals>
    <ml4u-nav selected-index="{{selectedDay}}" selected-sub-index={{selectedTrack}} tabs="[[_tabs]]" ></ml4u-nav>
    <ml4u-list items="[[_items]]" selected-day="[[selectedDay]]"
        selected-item={{selectedItem}}
        profile-data={{profileData}} id-prefix="sched">
    </ml4u-list>
  </template>

  <script>
  Polymer({
    is: 'ml4u-page-schedule',
    properties: {
      route: Object,
      ironRouteHash: {
        type: String,
        observer: '_onIronRouteHashChanged'
      },
      username: {
        type: String,
        notify: true
      },
      profileData: {
        type: Object,
        notify: true
      },
      selectedItem: {
        type:String,
        notify: true
      },
      selectedDay: {
        type:Number,
        value: 0
      },
      selectedTrack: {
        type:Number,
        value: 0
      },
      _tabs: {
        type: Array,
        value: []
      },
      _items: {
        type: Array,
        value: []
      },
      showPosters: {
        type: Boolean,
        value: false
      }
    },
    observers: [
      '_onSelectedItemsChanged(selectedDay, selectedTrack)'
    ],

    _onIronRouteHashChanged: function(newVal) {
      if (newVal == undefined || newVal == "") {
        this.selectedDay = 0;
        this.selectedTrack = 0;
      }
      else {
        this.selectedDay = newVal[0];
        this.selectedTrack = newVal.length > 1 ? newVal[1] : 0;
      }
    },

    _onSelectedItemsChanged: function(day, track) {
      if(day == undefined || track==undefined)
        return;
      this._items = window.ml4u.sharedElements.scheduleDataProvider.getSessionsSchedule(day, track);
    },

    _onScheduleDataChanged: function(e) {
      this._tabs = window.ml4u.sharedElements.scheduleDataProvider.getSessionsDaysArray();
      this._items = window.ml4u.sharedElements.scheduleDataProvider.getSessionsSchedule(this.selectedDay);
    },
    ready: function() {
      //this.selectedDay = this.ironRouteHash || '0';
      //if(this.route !== undefined && this.route.__queryParams.itemid !== undefined)
      //  this.selectedItem = this.route.__queryParams.itemid;

      if(this._tabs.length==0) {
        this._tabs = window.ml4u.sharedElements.scheduleDataProvider.getSessionsDaysArray();
      }
    },

    favChanged: function(e) {

    },
    profileDataChanged: function(e) {

    }
/*
    favChanged: function(e) {
      console.log("favChanged called with the following e:");
      console.log(e);
      if(e.base == undefined) {
        this.fav1 = this.fav2 = this.fav3 = "";
        return;
      }

      //TODO: Rework this to use the e object, which provides info
      //on which propery has been changed

      this.profileData.bookmarks = this.profileData.bookmarks || {};

      if(this.profileData.bookmarks.item1) {
        this.fav1 = "favourite";
      }
      else {
        this.fav1 = "";
      }
      if(this.profileData.bookmarks.item2) {
        this.fav2 = "favourite";
      }
      else {
        this.fav2 = "";
      }
      if(this.profileData.bookmarks.item3) {
        this.fav3 = "favourite";
      }
      else {
        this.fav3 = "";
      }
    },
    buttonPressed: function(itemId) {
      console.log("buttonPressed called. profileData=");
      console.log(this.profileData);
      if(this.username == null) {
        window.ml4u.sharedElements.papertoast.text = "Please login first.";
        window.ml4u.sharedElements.papertoast.open();
        return;
      }

      this.profileData.bookmarks = this.profileData.bookmarks || {};

      if(this.profileData.bookmarks['item'+itemId]) {
        this.set(['profileData.bookmarks','item'+ itemId], false);
      }
      else {
        this.set(['profileData.bookmarks','item'+ itemId], true);
      }
      console.log(this.profileData.bookmarks);
    },
    profileDataChanged: function(e) {
      console.log("%%%%%%%%%%%%%%%%profileDataChanged called");
      console.log(e);
    }*/

  });

  </script>
</dom-module>
