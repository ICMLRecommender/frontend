<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="ml4u-topics-selector">
  <template>
    <style>
      :host {
        margin-left: -20px;
      }
      .topic {
        display: block;
        height: auto;
        width: 100%;
        background: #FAFAFA;
        border: 1px solid #DCDCDC;
        border-bottom: 0;
        padding-top: 16px;
        padding-bottom: 16px;
        cursor: pointer;
      }
      .topic:hover {
        background: #EDEDED;
      }
      .selected {
        background: #EDF5E3 !important;
      }
      .topic:last-of-type {
        border-bottom: 1px solid #DCDCDC;
      }
      .check {
        height: 100%;
        width: 15%;
        text-align:center;
        padding-left: 10px;
        vertical-align: top;
        display: inline-block;
      }
      .topic-info {
        display: inline-block;
        width: 75%;
        padding-right: 10px;
      }
      .check > iron-icon {
        margin-top: 2px;
        opacity: 0.54;
      }
      .selected > .check > iron-icon {
        color: green;
      }
      span.topicTitle {
        font-size: 19px;
        color: #51623E;
      }
      span.keywordsTitle {
        font-size: 16px;
        color: #8E9982;
      }
      span.keywordsList {
        font-size: 16px;
        color: #8E9982;
      }
      .keywords {
        line-height: 1.4em;
      }
      .hint {
        display: block;
        margin: 30px 15px 40px 20px;
      }
      .info-bulb-topics {
        padding: 22px;
        font-family: 'effra', sans-serif;
        -webkit-box-decoration-break: clone;
        box-decoration-break: clone;
        color: rgb(94, 94, 91);
      }
    </style>
    <div class="hint">
      <img src="/images/bulb.png" style="float:left;"/>
      <span class="info-bulb-topics" style="font-size: 23px;">Which topics are you interested in?</span>
    </div>
    <div style="clear: both;">
    <template is="dom-repeat" items="{{topics.topics}}">
      <div style="clear:both;" class="topic" on-tap="toggleTopic" id="topic{{index}}">
        <div class="check">
          <iron-icon icon="icons:check"></iron-icon>
        </div>
        <div class="topic-info">
          <span class="topicTitle">{{item.title}}</span><br/>
          <div class="keywords"><span class="keywordsTitle">Keywords: </span>
          <span class="keywordsList"><template is="dom-repeat" items={{item.keywords}} as="keyword">{{keyword}} </template></span><div>
        </div>
      </div>
    </template>
    </div>
  </template>

  <script>
   Polymer({
      is: 'ml4u-topics-selector',
      properties: {
        topics: {
          type: Object,
          notify: true
        },
        selectedTopics: {
          type: Object,
          notify: true,
          value: {}
        }
      },
      toggleTopic: function(e) {
        var path = e.path;
        var topicId = -1;
        var parentDiv;
        console.log(e);
        console.log(e['_path']);
        const path_length = e.path ? e.path.length : e._path.length; // safari workaround
        for (var i=0; i < path_length; ++i) {
          if(e.path[i].id.includes("topic")) {
            parentDiv = e.path[i];
            id = e.path[i].id;
            topicId = Number(id.substr(5));
            break;
          }
        }

        if(parentDiv.className.includes("selected")) {
          strIndex_start = parentDiv.className.indexOf("selected");
          parentDiv.className = parentDiv.className.substr(0, strIndex_start);
          delete this.selectedTopics[''+topicId];
        }
        else {
          parentDiv.className += " selected";
          this.selectedTopics[''+topicId] = topicId;
        }
      },
    });
  </script>
</dom-module>
