<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="ml4u-topics-selector">
  <template>
    <style>
      .topic {
        display: block;
        height: 63px;
        width: 100%;
        background: #FAFAFA;
        border: 1px solid #DCDCDC;
        padding: 10px;
      }
      .check > iron-icon {
        float: left;
        margin-left: 20px;
        margin-right: 20px;
        margin-bottom: 8px;
        margin-top: 8px;
        opacity: 0.54;
      }
      .selected > .check > iron-icon {
        color: green;
      }
      span.topicTitle {
        font-size: 19px;
        color: #51623E;
      }
      span.keywordsTitle {
        font-size: 16px;
        color: #8E9982;
      }
      span.keywordsList {
        font-size: 16px;
        color: #8E9982;
      }
      div.keywords {
        line-height: 1.0;
      }
      div.selected {
        background-color: #EDF5E3;
      }
      div.hint {
        display: block;
        margin: 30px 10px 60px 30px;
      }
      span.info-bulb-topics {
        padding: 35px;
        font-family: 'Ubuntu';
        -webkit-box-decoration-break: clone;
        box-decoration-break: clone;
      }
    </style>
    <div class="hint">
      <img src="/images/bulb.png" style="float:left;"/>
      <span class="info-bulb-topics" style="font-size: 23px;">Which topics are you interested in?</span>
    </div>
    <div style="clear: both;">
    <template is="dom-repeat" items="{{topics.topics}}">
      <div style="clear:both;" class="topic" on-tap="toggleTopic" id="topic{{index}}">
        <div class="check">
          <iron-icon icon="icons:check"></iron-icon>
        </div>
        <div>
          <span class="topicTitle">{{item.title}}</span><br/>
          <div class="keywords"><span class="keywordsTitle">Keywords: </span>
          <span class="keywordsList"><template is="dom-repeat" items={{item.keywords}} as="keyword">{{keyword}} </template></span><div>
        </div>
      </div>
    </template>
    </div>
  </template>

  <script>
   Polymer({
      is: 'ml4u-topics-selector',
      properties: {
        topics: {
          type: Object,
          notify: true
        },
        selectedTopics: {
          type: Object,
          notify: true,
          value: {}
        }
      },
      toggleTopic: function(e) {
        var path = e.path;
        var topicId = -1;
        var parentDiv;
        for (var i=0; i < e.path.length; ++i) {
          if(e.path[i].id.includes("topic")) {
            parentDiv = e.path[i];
            id = e.path[i].id;
            topicId = Number(id.substr(5));
            break;
          }
        }

        if(parentDiv.className.includes("selected")) {
          strIndex_start = parentDiv.className.indexOf("selected");
          parentDiv.className = parentDiv.className.substr(0, strIndex_start);
          delete this.selectedTopics[''+topicId];
        }
        else {
          parentDiv.className += " selected";
          this.selectedTopics[''+topicId] = topicId;
        }
      },
    });
  </script>
</dom-module>
